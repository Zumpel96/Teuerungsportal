@page "/stores/{storeName}/{productNumber}"
@using Teuerungsportal.Models

<PageTitle>@L?["appName"] - @L?["product"]</PageTitle>

<MudGrid>
    <MudItem xs="12">
        @if (IsLoading)
        {
            <MudSkeleton Class="my-2" Width="20%" Height="2rem"/>
        }
        else
        {
            <MudBreadcrumbs Items="@ParentCategories"/>
        }
    </MudItem>

    <MudItem xs="12">
        @if (IsLoading)
        {
            <MudSkeleton Width="40%" Height="8rem"/>
        }
        else
        {
            <MudText Typo="Typo.h1">@CurrentProduct.Name</MudText>
        }
        <MudAlert Severity="Severity.Info">@L?["productInfo"]</MudAlert>
        <MudDivider/>
    </MudItem>

    <MudItem xs="12" md="4">
        <MudPaper>
            <MudText Typo="Typo.h2">@L?["metadata"]</MudText>
            <MudDivider/>

            <MudText Typo="Typo.h3">@L?["brand"]</MudText>
            @if (IsLoading)
            {
                <MudSkeleton Width="40%" Height="1rem"/>
            }
            else
            {
                <MudText Typo="Typo.body1">@CurrentProduct.Brand</MudText>
            }

            <MudText Typo="Typo.h3" Class="mt-4">@L?["store"]</MudText>
            @if (IsLoading)
            {
                <MudSkeleton Width="20%" Height="1rem"/>
            }
            else
            {
                <MudText Typo="Typo.body1">@CurrentProduct.Store.Name</MudText>
            }

            <MudText Typo="Typo.h3" Class="mt-4">@L?["articleNumber"]</MudText>
            @if (IsLoading)
            {
                <MudSkeleton Width="60%" Height="1rem"/>
            }
            else
            {
                <MudText Typo="Typo.body1">@CurrentProduct.ArticleNumber</MudText>
            }

            @if (CurrentProduct.Category != null || IsLoading)
            {
                <MudText Typo="Typo.h3"  Class="mt-4">@L?["category"]</MudText>
            }

            @if (IsLoading || IsCategorizing)
            {
                <MudSkeleton Width="80%" Height="1rem"  Class="mt-4"/>
            }
            else
            {
                @if (CurrentProduct.Category != null)
                {
                    <MudText Typo="Typo.body1">@CurrentProduct.Category.Name</MudText>
                }
                else
                {
                    <MudSelect Value="@SelectedCategory" Disabled="@(IsLoading || IsCategorizing)" T="Category?" Placeholder="@L?["addCategory"]" AnchorOrigin="Origin.BottomCenter" Variant="Variant.Outlined" AdornmentIcon="@Icons.Material.Filled.Search" AdornmentColor="Color.Primary" ValueChanged="@((Category? category) => AddCategory(CurrentProduct, category))">
                        <MudSelectItem Value="@(new Category() { Name = "newCategory" })">
                            @L?["createCategory"]
                        </MudSelectItem>

                        <MudSelectItem Value="@(new Category())" Disabled>
                            <MudDivider/>
                        </MudSelectItem>

                        @foreach (var category in AllCategories)
                        {
                            <CategoryVisualizer Category="@category" RecursionLevel="0"/>

                            @if (category != AllCategories.Last())
                            {
                                <MudSelectItem Value="@(new Category())" Disabled>
                                    <MudDivider/>
                                </MudSelectItem>
                            }
                        }
                    </MudSelect>
                }
            }

            @if (IsLoading)
            {
                <MudSkeleton Width="30%" Height="1rem" Class="mt-4"/>
            }
            else
            {
                <MudLink  Class="mt-4" Href="@($"{CurrentProduct.Store.BaseUrl}{CurrentProduct.Url}")" Typo="Typo.body1" Target="blank">@L["onlineShopLink"]</MudLink>
            }
        </MudPaper>
    </MudItem>

    <MudItem xs="12" md="8">
        <MudPaper>
            <MudText Typo="Typo.h2">@L?["history"]</MudText>

            @if (IsLoading)
            {
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="100%" Height="400px"/>
            }
            else
            {
                <PriceTransitionChart ProductName="@CurrentProduct.Name" PriceData="@PriceHistory"/>
            }
        </MudPaper>
    </MudItem>

    <MudItem xs="12">
        <MudPaper>
            <MudText Typo="Typo.h2">@L?["recentPriceChanges"]</MudText>

            <RecentPriceChanges PriceChanges="@PriceHistory" Page="CurrentPricePage" NumberOfPages="PricePages" HideStore PageChanged="@OnPricePageChanged" IsLoading="IsLoading"/>
        </MudPaper>
    </MudItem>
</MudGrid>